name: Extract and Release

on:
    workflow_dispatch:
        inputs:
            ROM_URL:
                description: "ROM_URL"
                default: "https://github.com/sakshiagrwal/SourceforgeBackup/releases/download/crDroid/crDroidAndroid-13.0-20230607-spes-v9.5.zip"

jobs:
    build-and-release:
        runs-on: ubuntu-latest
        permissions: write-all
        steps:
            - name: Checkout code
              uses: actions/checkout@v4

            - name: Download file
              run: curl -LJO ${{ github.event.inputs.ROM_URL }}

            - name: Extract Payload
              run: |
                  chmod u+x .github/scripts/android-ota-extractor
                  .github/scripts/android-ota-extractor *.zip
                  find . ! -name 'product.img' -delete
                  7z x product.img
                  echo "__________________"
                  ls
                  echo "-------app--------"
                  ls app
                  echo "-----priv-app-----"
                  ls priv-app
                  echo "__________________"

            - name: Upload to Release
              uses: softprops/action-gh-release@v2
              env:
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
              with:
                  files: priv-app/Dialer/Dialer.apk
                  name: ${{ github.run_id }}
                  tag_name: ${{ github.run_id }}
